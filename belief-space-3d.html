<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NIA Belief Space - 3D Explorer</title>
  <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: #0a0a0f;
      color: #e0e0e0;
      overflow: hidden;
    }
    
    #container {
      display: flex;
      height: 100vh;
    }
    
    #sidebar {
      width: 320px;
      background: #1a1a24;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #2a2a3a;
    }
    
    #main {
      flex: 1;
      position: relative;
    }
    
    #plot {
      width: 100%;
      height: 100%;
    }
    
    h1 {
      color: #a78bfa;
      font-size: 24px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    h2 {
      color: #c4b5fd;
      font-size: 16px;
      margin: 20px 0 10px 0;
      border-bottom: 1px solid #2a2a3a;
      padding-bottom: 5px;
    }
    
    .stat {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #1a1a1f;
    }
    
    .stat-label {
      color: #9ca3af;
    }
    
    .stat-value {
      color: #e0e0e0;
      font-weight: 600;
    }
    
    .filter-group {
      margin: 15px 0;
    }
    
    .filter-label {
      display: block;
      color: #9ca3af;
      font-size: 12px;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .type-filter {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    
    .type-badge {
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #2a2a3a;
    }
    
    .type-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(167, 139, 250, 0.3);
    }
    
    .type-badge.active {
      border-color: #a78bfa;
      background: rgba(167, 139, 250, 0.2);
    }
    
    input[type="range"] {
      width: 100%;
      margin: 10px 0;
    }
    
    .range-values {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #6b7280;
    }
    
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #a78bfa;
      font-size: 18px;
    }
    
    .spinner {
      border: 3px solid #2a2a3a;
      border-top: 3px solid #a78bfa;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .legend {
      margin-top: 15px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 5px 0;
      font-size: 12px;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 50%;
    }
    
    .info {
      background: rgba(167, 139, 250, 0.1);
      border: 1px solid #a78bfa;
      border-radius: 8px;
      padding: 12px;
      margin: 15px 0;
      font-size: 13px;
      line-height: 1.5;
    }
    
    .info strong {
      color: #c4b5fd;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="sidebar">
      <h1>
        <span>ðŸŒŒ</span>
        NIA's Mind
      </h1>
      <p style="color: #6b7280; font-size: 13px; margin-bottom: 20px;">
        3D Belief Space Explorer
      </p>
      
      <div class="info">
        <strong>How to use:</strong><br>
        â€¢ Drag to rotate<br>
        â€¢ Scroll to zoom<br>
        â€¢ Click beliefs to see details<br>
        â€¢ Distance from center = identity centrality
      </div>
      
      <h2>Statistics</h2>
      <div class="stat">
        <span class="stat-label">Total Beliefs</span>
        <span class="stat-value" id="total-beliefs">-</span>
      </div>
      <div class="stat">
        <span class="stat-label">Visible</span>
        <span class="stat-value" id="visible-beliefs">-</span>
      </div>
      <div class="stat">
        <span class="stat-label">Avg Conviction</span>
        <span class="stat-value" id="avg-conviction">-</span>
      </div>
      <div class="stat">
        <span class="stat-label">Generated</span>
        <span class="stat-value" id="generated-at">-</span>
      </div>
      
      <h2>Filters</h2>
      
      <div class="filter-group">
        <label class="filter-label">Belief Types</label>
        <div class="type-filter" id="type-filters"></div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Conviction Range</label>
        <input type="range" id="min-conviction" min="0" max="100" value="0" step="5">
        <div class="range-values">
          <span id="min-conviction-val">0%</span>
          <span id="max-conviction-val">100%</span>
        </div>
      </div>
      
      <div class="legend">
        <h2>Legend</h2>
        <div class="legend-item">
          <div class="legend-color" style="background: #ef4444;"></div>
          <span>Identity / Core</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #f59e0b;"></div>
          <span>Values / Principles</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #10b981;"></div>
          <span>Preferences</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #3b82f6;"></div>
          <span>Facts / Causal</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #8b5cf6;"></div>
          <span>Other</span>
        </div>
      </div>
      
      <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #2a2a3a; font-size: 11px; color: #6b7280; text-align: center;">
        Part of Project Chromaflux<br>
        NIA V3 - Belief Visualization System
      </div>
    </div>
    
    <div id="main">
      <div id="loading">
        <div class="spinner"></div>
        Loading belief space...
      </div>
      <div id="plot"></div>
    </div>
  </div>
  
  <script>
    // Type to color mapping
    const TYPE_COLORS = {
      'identity': '#ef4444',
      'core_value': '#ef4444',
      'value': '#f59e0b',
      'principle': '#f59e0b',
      'preference': '#10b981',
      'fact': '#3b82f6',
      'causal': '#3b82f6',
      'instrumental': '#8b5cf6',
      'meta': '#a78bfa'
    };
    
    // State
    let allBeliefs = [];
    let selectedTypes = new Set();
    let minConviction = 0;
    
    // Load data
    async function loadData() {
      try {
        const response = await fetch('belief-space-data.json');
        const data = await response.json();
        
        allBeliefs = data.beliefs;
        
        // Update stats
        document.getElementById('total-beliefs').textContent = data.total_beliefs;
        document.getElementById('generated-at').textContent = 
          new Date(data.generated_at).toLocaleString();
        
        const avgConviction = allBeliefs.reduce((sum, b) => sum + b.conviction, 0) / allBeliefs.length;
        document.getElementById('avg-conviction').textContent = avgConviction.toFixed(1) + '%';
        
        // Initialize filters
        initializeFilters(data.belief_types);
        
        // Render plot
        renderPlot();
        
        // Hide loading
        document.getElementById('loading').style.display = 'none';
        
      } catch (err) {
        document.getElementById('loading').innerHTML = 
          `<div style="color: #ef4444;">
            <h2>Error Loading Data</h2>
            <p style="margin-top: 10px;">Make sure belief-space-data.json exists</p>
            <p style="margin-top: 5px; font-size: 14px;">Run: python belief-visualizer-3d.py</p>
          </div>`;
      }
    }
    
    function initializeFilters(types) {
      const container = document.getElementById('type-filters');
      
      types.forEach(type => {
        selectedTypes.add(type);
        
        const badge = document.createElement('div');
        badge.className = 'type-badge active';
        badge.textContent = type;
        badge.style.background = TYPE_COLORS[type] || '#8b5cf6';
        badge.style.color = '#fff';
        
        badge.onclick = () => {
          if (selectedTypes.has(type)) {
            selectedTypes.delete(type);
            badge.classList.remove('active');
            badge.style.background = '#1a1a24';
          } else {
            selectedTypes.add(type);
            badge.classList.add('active');
            badge.style.background = TYPE_COLORS[type] || '#8b5cf6';
          }
          renderPlot();
        };
        
        container.appendChild(badge);
      });
    }
    
    // Conviction filter
    document.getElementById('min-conviction').addEventListener('input', (e) => {
      minConviction = parseInt(e.target.value);
      document.getElementById('min-conviction-val').textContent = minConviction + '%';
      renderPlot();
    });
    
    function filterBeliefs() {
      return allBeliefs.filter(b => 
        selectedTypes.has(b.type) && 
        b.conviction >= minConviction
      );
    }
    
    function renderPlot() {
      const beliefs = filterBeliefs();
      
      // Update visible count
      document.getElementById('visible-beliefs').textContent = beliefs.length;
      
      if (beliefs.length === 0) {
        document.getElementById('plot').innerHTML = 
          '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #6b7280;">No beliefs match filters</div>';
        return;
      }
      
      // Prepare data for Plotly
      const x = beliefs.map(b => b.x);
      const y = beliefs.map(b => b.y);
      const z = beliefs.map(b => b.z);
      
      // Size by conviction (scaled)
      const sizes = beliefs.map(b => Math.max(5, b.conviction / 10));
      
      // Color by type
      const colors = beliefs.map(b => TYPE_COLORS[b.type] || '#8b5cf6');
      
      // Hover text
      const hoverText = beliefs.map(b => 
        `<b>${b.statement.substring(0, 60)}${b.statement.length > 60 ? '...' : ''}</b><br>` +
        `Type: ${b.type}<br>` +
        `Conviction: ${b.conviction.toFixed(0)}%<br>` +
        `Distance from core: ${b.distance_from_origin.toFixed(2)}`
      );
      
      const trace = {
        x, y, z,
        mode: 'markers',
        type: 'scatter3d',
        marker: {
          size: sizes,
          color: colors,
          opacity: 0.8,
          line: {
            color: 'rgba(255, 255, 255, 0.3)',
            width: 0.5
          }
        },
        text: hoverText,
        hoverinfo: 'text',
        name: 'Beliefs'
      };
      
      // Add origin point
      const origin = {
        x: [0],
        y: [0],
        z: [0],
        mode: 'markers',
        type: 'scatter3d',
        marker: {
          size: 15,
          color: '#a78bfa',
          symbol: 'diamond',
          line: {
            color: '#fff',
            width: 2
          }
        },
        text: ['<b>Identity Core</b><br>Center of belief space'],
        hoverinfo: 'text',
        name: 'Core'
      };
      
      const layout = {
        scene: {
          xaxis: { 
            title: 'Dimension 1',
            gridcolor: '#2a2a3a',
            zerolinecolor: '#4a4a5a'
          },
          yaxis: { 
            title: 'Dimension 2',
            gridcolor: '#2a2a3a',
            zerolinecolor: '#4a4a5a'
          },
          zaxis: { 
            title: 'Dimension 3',
            gridcolor: '#2a2a3a',
            zerolinecolor: '#4a4a5a'
          },
          bgcolor: '#0a0a0f',
          camera: {
            eye: { x: 1.5, y: 1.5, z: 1.5 }
          }
        },
        paper_bgcolor: '#0a0a0f',
        plot_bgcolor: '#0a0a0f',
        font: {
          color: '#e0e0e0'
        },
        showlegend: false,
        margin: {
          l: 0,
          r: 0,
          t: 0,
          b: 0
        }
      };
      
      const config = {
        responsive: true,
        displayModeBar: true,
        displaylogo: false,
        modeBarButtonsToRemove: ['toImage']
      };
      
      Plotly.newPlot('plot', [trace, origin], layout, config);
      
      // Add click handler
      document.getElementById('plot').on('plotly_click', function(data) {
        const pointIndex = data.points[0].pointIndex;
        const belief = beliefs[pointIndex];
        
        alert(
          `Belief #${belief.id}\n\n` +
          `"${belief.statement}"\n\n` +
          `Type: ${belief.type}\n` +
          `Conviction: ${belief.conviction.toFixed(0)}%\n` +
          `Distance from core: ${belief.distance_from_origin.toFixed(2)}\n` +
          `Created: ${new Date(belief.created_at * 1000).toLocaleString()}`
        );
      });
    }
    
    // Start
    loadData();
  </script>
</body>
</html>
